### **UI 交互逻辑规划 (Dialog-Centric Approach)**

整个用户旅程可以分为三个核心阶段：**1. 初始化设置** -> **2. 策略构建** -> **3. 结果分析**。

#### **第一阶段：初始化设置**

**1. 主界面 (Strategy Dashboard) - 初始状态**

- 当用户首次进入应用时，看到的是一个简洁干净的“策略仪表盘”。
- 屏幕中央是一个醒目的欢迎信息和引导卡片，上面有一个主操作按钮 **[ 创建新策略回测 ]**。
- 整个界面大部分是空白的，暗示着这里将是展示策略内容的地方。

**2. 策略设置向导 (Setup Wizard Dialog)**

- 用户点击 **[ 创建新策略回测 ]** 按钮。
- 系统会弹出一个模态对话框 (Modal Dialog)，标题为“**第一步：设置回测基础参数**”。这个对话框会锁定背景，强制用户专注于完成这个关键步骤。
- **对话框内容**:
  - **ETF 代码**: 一个输入框，带有 placeholder 提示，例如“请输入 ETF 代码，如 QQQ”。
  - **回测时间范围**: 两个并排的日期选择器，“开始日期”和“结束日期”。
  - **初始本金**: 一个数字输入框，前面带有货币符号 “$”，并有默认值，例如“10000”。
- **对话框底部按钮**:

  - **[ 开始设计策略 ]**: 一个亮色的主操作按钮。
  - **[ 取消 ]**: 一个次要的关闭按钮。

- **交互逻辑**: 用户填好所有参数后，点击 **[ 开始设计策略 ]**。对话框关闭，后台开始异步加载该 ETF 的历史数据（此时主界面可以显示一个不易察觉的加载指示器）。

#### **第二阶段：策略构建**

**1. 主界面 (Strategy Dashboard) - 设计状态**

- 对话框关闭后，主界面内容更新，不再是空白。
- **顶部信息栏**: 清晰地展示用户刚刚设置的参数：“**回测标的: QQQ** | **时间范围: 2015-01-01 至 2024-12-31** | **初始本金: $10,000**”。这让用户时刻明确自己正在操作的上下文。
- **策略标识区 [新增]**:
  - 在触发器列表上方，增加一个显眼的标题输入框：**“策略名称：[ QQQ 均线回归策略 ]”** (支持修改，默认为 "未命名策略")。
  - 下方有一行提示文本：**“本策略包含以下交易规则（规则之间为 '或' 的关系）：”**。这明确了所有触发器属于同一个策略容器。
- **中央核心区 - “触发器列表”**:
  - 这是一个目前为空的列表区域，标题为“**当前策略的规则组合**”。
  - 列表上方有一个非常醒目的、带 “+” 号的按钮 **[ 添加新触发器 ]**。
- **底部操作栏**:
  - 有一个主操作按钮 **[ 运行此策略的回测 ]**。**重要：** 在没有任何触发器被添加时，此按钮处于**禁用 (Disabled) 状态**，并有提示文字“请至少添加一条触发器”。

**2. 触发器构建器 (Trigger Builder Dialog)**

- 用户点击 **[ 添加新触发器 ]** 按钮。
- 系统弹出第二个核心的模态对话框，标题为“**创建交易触发器**”。这个对话框是整个工具的灵魂。
- **对话框内部布局 (自上而下)**:
  1.  **“IF 条件”区域**:
      - 一个标签“**如果 (IF)...**”。
      - 一个分组下拉菜单，用于选择触发器类型（“价格行为”、“技术指标”等）。
      - 根据用户的选择，下方会**动态地渲染**出所需的参数输入框。例如，选择“价格从高点回撤”，则出现“下跌超过 [%]”和“从过去 [ ] 交易日的高点”两个输入框。这个动态交互非常重要，避免了静态表单的臃肿。
  2.  **“THEN 动作”区域**:
      - 一个标签“**那么 (THEN)...**”。
      - 一个下拉菜单选择“买入”或“卖出”。
      - 下方同样**动态渲染**出数值输入区域，例如选择“买入”，则出现“固定金额 [$]”或“可用现金的 [%]”等选项。
  3.  **“频率控制”区域**:
      - 一个标签“**并且 (AND)...**”。
      - 一个复选框，“[✓] 启用冷却期”。
      - 勾选后，出现“在 [ ] 个交易日内不再重复触发”的输入框。
- **对话框底部按钮**:

  - **[ 添加此规则 ]**: 主操作按钮。
  - **[ 取消 ]**

- **交互逻辑**: 用户配置完毕，点击 **[ 添加此规则 ]**。对话框关闭。

**3. 主界面 - 规则填充状态**

- 每当一个触发器被添加，主界面的“**当前策略的规则组合**”列表中就会增加一项。
- 每一项都应该是一句**人类可读的完整描述**，例如：“**规则 1：** 如果价格从 60 日高点下跌超过 15%，那么买入 1000 元 (冷却期: 5 天)”。
- 每一项的右侧都有一个“**删除**”图标按钮。
- 此时，底部的 **[ 运行此策略的回测 ]** 按钮变为**可用状态**。

#### **第三阶段：结果分析**

**1. 回测运行中 (Loading Dialog)**

- 用户对策略满意后，点击主界面上的 **[ 运行回测 ]** 按钮。
- 系统立即弹出一个**非模态的、不可关闭的**加载对话框，标题为“**正在执行回测...**”。
- 对话框内可以有一个动画加载指示器（Spinner）和一些提示性文字，如“正在分析数千个交易日的数据，请稍候”。这能有效缓解用户的等待焦虑。

**2. 策略回测报告 (Results Report Dialog) - UX 升级版**

- 回测计算完成后，加载对话框自动关闭，取而代之的是一个**全屏或大尺寸的**模态对话框，标题为“**策略回测报告**”。这营造了一种“发布正式报告”的仪式感。
- **对话框内部布局**:
  1.  **顶部“关键指标 (KPI)”卡片区**:
      - 使用醒目的卡片并排展示核心数据。
      - **卡片 1**: “**我的策略**”，下方是“年化回报率”、“最大回撤”等数据。
      - **卡片 2**: “**基准：买入并持有**”，下方是对应的“年化回报率”、“最大回撤”等数据。通过颜色对比（例如，如果你的策略回报率更高，则显示为绿色）提供即时反馈。
  2.  **中央“净值曲线”图表区**:
      - 这是对话框中最大的区域。
      - 一张折线图，包含两条曲线：一条是“我的策略”，另一条是“买入并持有”。图例清晰，用户可以直观地看到策略在何时跑赢或跑输基准。
  3.  **底部“详细数据”标签页区 (可选，用于高级分析)**:
      - 可以有多个标签页，如“年度回报率对比”、“交易历史记录”等。
- **对话框底部按钮**:

  - 只有一个清晰的 **[ 关闭报告 ]** 或 **[ 返回设计器 ]** 按钮。

- **交互逻辑**: 用户分析完报告后，点击关闭按钮，结果对话框消失，返回到策略设计的主界面。用户可以继续修改触发器，然后再次运行回测，形成一个“**设计 -> 测试 -> 优化**”的闭环。

### 6. 发现页 / 排行榜 (Discovery / Leaderboard)

**目标**: 展示平台上表现最好的公开策略。

- **入口**: 顶部导航栏 -> "发现" (Discovery)。
- **布局**:
  - **顶部筛选器**:
    - ETF 标的 (如: 全部, QQQ, SPY)
    - 排序依据 (如: 年化回报率, 夏普比率, 收藏数)
  - **列表/卡片视图**:
    - 每张卡片展示: 策略名称、作者头像/昵称、核心指标 (CAGR, Max Drawdown)、迷你走势图 (Sparkline)。
- **交互**:
  - 点击卡片 -> 打开 **策略详情预览模态框** (只读模式)。
  - 在预览模态框中 -> 提供 "运行回测" (实时验证) 和 "克隆此策略" (仅登录用户) 按钮。

* **策略详情预览模态框 (Strategy Detail Modal)**:
  - **顶部**: 策略基本信息、作者、复制按钮。
  - **中部**: 回测图表、关键指标。
  - **底部**: **评论区 (Comments Section) [新增]**
    - **输入框**: "写下你的想法..." (未登录显示 "登录后发表评论")。
    - **评论列表**:
      - **顶级评论**: 显示头像、昵称、时间、内容。
      - **操作栏**: [回复] [删除(如果是作者)]。
      - **嵌套回复 (Replies)**: 缩进显示在父评论下方，背景色稍淡，形成对话流。

通过这种以对话框为核心的交互设计，我们将复杂的流程分解为一系列专注、独立的任务，极大地降低了用户的认知负荷，使得整个策略设计过程既强大又易于上手。
