

### **项目：ETF 投资策略设计与回测工具**

#### **史诗 (Epic) 1: 策略回测准备**
*(这个史诗涵盖了运行一次完整回测前的所有准备工作)*

**用户故事 1.1: 获取 ETF 数据**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 输入一个 ETF 的代码（如 SPY）和一个时间范围，
*   **以便** 工具能够为我的策略回测准备好所需的历史价格数据。

    **验收标准 (Acceptance Criteria):**
    1.  界面上有一个输入框用于填写 ETF 代码。
    2.  界面上有两个日期选择器用于设定回测的开始和结束日期。
    3.  点击“加载数据”按钮后，系统能从后端数据源获取对应的日线数据 (OHLCV)。
    4.  数据加载成功后，界面上显示“数据加载成功”的提示。
    5.  如果输入的代码无效或该时段无数据，系统会显示明确的错误信息。

**用户故事 1.2: 设定初始资金**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 为我的回测设定一个初始本金，
*   **以便** 所有的模拟交易和最终收益计算都有一个明确的起点。

    **验收标准 (Acceptance Criteria):**
    1.  在策略设计区域，有一个标记为“初始本金”的数字输入框。
    2.  该输入框只接受正数。
    3.  设定的初始本金将被回测引擎用作起始现金余额。

---

#### **史诗 (Epic) 2: 构建核心价格策略**
*(这个史诗专注于用户与策略设计器的交互，创建基于价格的规则)*

**用户故事 2.1: 创建“逢低买入”触发器**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 创建一个基于“价格从高点回撤”的买入触发器，
*   **以便** 我能自动化执行我的“打折就买”的核心投资逻辑。

    **验收标准 (Acceptance Criteria):**
    1.  在触发器构建器中，我可以选择“价格从高点回撤”作为条件。
    2.  我可以设定一个回撤百分比 (例如: `15%`)。
    3.  我可以设定一个计算高点的时间窗口 (例如: `60个交易日`)。
    4.  我可以设定触发后的动作为“买入”，并指定买入的金额 (例如: 固定金额`1000元` 或 可用现金的`10%`)。
    5.  添加后，这条规则会以易于理解的语言（例如：“如果价格从60日高点下跌超过15%，则买入1000元”）出现在规则列表中。

**用户故事 2.2: 创建“逢高卖出”触发器**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 创建一个基于“价格创下新高”的卖出触发器，
*   **以便** 我能在市场情绪高涨时自动锁定部分利润。

    **验收标准 (Acceptance Criteria):**
    1.  在触发器构建器中，我可以选择“价格创下新高”作为条件。
    2.  我可以设定一个计算新高的时间窗口 (例如: `250个交易日`)。
    3.  我可以设定触发后的动作为“卖出”，并指定卖出的仓位比例 (例如: `现有持仓的10%`)。
    4.  添加后，这条规则会出现在规则列表中。

**用户故事 2.3: 管理已创建的触发器**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 能够清晰地看到我已添加的所有规则，并且可以删除它们，
*   **以便** 我能方便地调整和优化我的整体策略。

    **验收标准 (Acceptance Criteria):**
    1.  界面上有一个专门的区域，用列表形式展示所有已添加的触发器。
    2.  每个触发器旁边都有一个“删除”按钮。
    3.  点击“删除”按钮后，对应的规则会从列表中移除，并且在后续的回测中不再生效。

**用户故事 2.4: 设置触发器冷却期**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 为我创建的触发器设置一个“冷却期”，
*   **以便** 避免在市场信号持续满足的短期内过于频繁地进行交易。

    **验收标准 (Acceptance Criteria):**
    1.  在触发器构建器中，有一个可选的“冷却期”设置项。
    2.  我可以输入一个数字和选择一个时间单位（例如: `5个交易日`）。
    3.  当一个设置了冷却期的触发器被执行后，它在指定的冷却期内将不会再次被触发，即使条件依然满足。

---

#### **史诗 (Epic) 3: 执行回测并分析结果**
*(这个史诗涵盖了从运行回测到最终结果呈现的全过程)*

**用户故事 3.1: 运行回测并查看核心结果**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 点击一个按钮来运行我设计好的策略，
*   **以便** 我能立即看到策略的最终总回报率。

    **验收标准 (Acceptance Criteria):**
    1.  界面上有一个清晰的“开始回测”按钮。
    2.  点击按钮后，回测引擎在后台运行，处理历史数据和策略规则。
    3.  回测完成后，结果页面会清晰地展示我的策略的“总回报率”和“年化回报率”。

**用户故事 3.2: 对比基准策略**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 在回测结果中看到我的策略与“买入并持有”策略的对比，
*   **以便** 我能客观地判断我的主动策略是否创造了超额收益。

    **验收标准 (Acceptance Criteria):**
    1.  结果页面上，除了我的策略回报率，还会同时展示在相同时间、相同资金下的“买入并持有”策略的“总回报率”和“年化回报率”。
    2.  有一个净值曲线图，用两条不同的曲线清晰地展示我的策略和“买入并持有”策略的资产增长过程。

**用户故事 3.3: 评估策略风险**
*   **作为** 一名投资者 (Alex)，
*   **我想要** 在回测结果中看到我的策略的“最大回撤”数据，
*   **以便** 我能了解这个策略在历史上可能遇到的最坏的账面亏损情况，评估其风险水平。

    **验收标准 (Acceptance Criteria):**
    1.  结果页面上会展示我的策略的“最大回撤”百分比。
    2.  为了便于比较，旁边也会展示“买入并持有”策略的“最大回撤”百分比。

这些用户故事共同构成了一个可执行的、有价值的最小可行产品 (MVP) 的开发待办列表 (Product Backlog)。开发团队可以从“史诗1”开始，逐个故事进行开发、测试和交付。